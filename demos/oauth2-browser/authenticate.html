<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ArcGIS Rest JS Vanilla JS</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
  </head>
  <body>
    <script src="node_modules/@esri/arcgis-rest-request/dist/umd/request.umd.js"></script>
    <script src="node_modules/@esri/arcgis-rest-auth/dist/umd/auth.umd.js"></script>
    <script src="node_modules/@esri/hub-auth/dist/umd/auth.umd.js"></script>
    <script>
      let session;
      const match = window.location.href.match(
        /&state=(.+)/
      );
      const clientId = match[1];

      arcgisHub.finishOAuth2({
        clientId,
      })
        .then(newSession => {
          debugger;
          session = newSession;
          localStorage.setItem('__ARCGIS_REST_USER_SESSION__', session.serialize());
          window.location.href = '/';
        })
        .catch(err => {
          debugger;
        })
    </script>
  </body>
</html>
