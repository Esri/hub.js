<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta name="date" content="2025-10-24T20:09:15.476Z">
    <title>Object Schema Versioning | Guide | @esri/hub.js</title>
    
    <meta name="description" content="A modular, high quality toolkit for working with ArcGIS Hub">
    
    <link rel="stylesheet" href="/hub.js/css/calcite-web.min.css">
    <link rel="stylesheet" href="/hub.js/css/style.css">
    
    
  </head>
  <body>
  <!-- Drawer -->
    <div class="drawer drawer-left js-drawer" data-drawer="top-nav" tabindex="0">
      <nav class="drawer-nav" role="navigation">
        <aside class="side-nav">
          <h2 class="side-nav-title">@esri/hub.js</h2>
          <a href="/hub.js/guides/" class="is-active side-nav-link">Guides</a>
          <a href="/hub.js/api/" class="side-nav-link">API Reference</a>
        </aside>
      </nav>
    </div>

    <div id="page" class="wrapper">
      <!-- Sample HTML -->
      <header class="top-nav">
        <div class="grid-container">
          <div class="column-24">
            <!-- desktop sized navigation -->
            <div class="tablet-hide">
              <!-- logo / home -->
              <a href="/hub.js/" class="top-nav-title">@esri/hub.js</a>
              <!-- primary navigation sections -->
              <nav class="top-nav-list" role="navigation" aria-labelledby="topnav">
                <a href="/hub.js/guides/" class="is-active top-nav-link">Guides</a>
                <a href="/hub.js/api/" class="top-nav-link">API Reference</a>
                <a href="https://github.com/Esri/hub.js" class="top-nav-link">GitHub</a>
              </nav>
            </div>

            <!-- tablet and mobile sized navigation -->
            <div class="tablet-show top-nav-flex">
              <!-- open primary navigation drawer -->
              <nav class="top-nav-flex-list" role="navigation" aria-labelledby="topnav">
                <a href="/hub.js/" class="icon-ui-menu top-nav-link js-drawer-toggle" data-drawer="top-nav"><span class="phone-hide">Menu</span></a>
              </nav>
              <!-- logo / home -->
              <header class="top-nav-flex-title">
                <a href="/hub.js/" class="top-nav-link">@esri/hub.js</a>
              </header>
            </div>
          </div>

        </div>
      </header>


      <main id="#skip-to-content">
        
  <div class="grid-container trailer-1 leader-1">
    <div class="column-6">
      <ul class="list-plain">
        
          <li>Intro</li>
          <ul class="list-plain margin-left-1">
            
              <li><a href="/hub.js/guides/intro/overview/">Overview</a></li>
            
              <li><a href="/hub.js/guides/intro/getting-started/">Getting Started</a></li>
            
          </ul>
        
          <li>Class Api</li>
          <ul class="list-plain margin-left-1">
            
              <li><a href="/hub.js/guides/classes/overview/">Overview</a></li>
            
              <li><a href="/hub.js/guides/classes/arcgiscontext/">Authentication</a></li>
            
              <li><a href="/hub.js/guides/classes/sites/">Sites (WIP)</a></li>
            
              <li><a href="/hub.js/guides/classes/pages/">Pages (WIP)</a></li>
            
              <li><a href="/hub.js/guides/classes/initiatives/">Initiatives (WIP)</a></li>
            
              <li><a href="/hub.js/guides/classes/projects/">Projects</a></li>
            
          </ul>
        
          <li>Functional Api</li>
          <ul class="list-plain margin-left-1">
            
              <li><a href="/hub.js/guides/functional/overview/">Overview</a></li>
            
              <li><a href="/hub.js/guides/functional/authentication/">Authentication</a></li>
            
              <li><a href="/hub.js/guides/functional/hub-search/">Hub Search</a></li>
            
              <li><a href="/hub.js/guides/functional/utilities/">Utilities</a></li>
            
              <li><a href="/hub.js/guides/functional/discussions-v2/">Discussions v2</a></li>
            
              <li><a href="/hub.js/guides/functional/discussions/">Discussions</a></li>
            
              <li><a href="/hub.js/guides/functional/teams/">Teams</a></li>
            
              <li><a href="/hub.js/guides/functional/versioning/">Versioning</a></li>
            
          </ul>
        
          <li>Advanced</li>
          <ul class="list-plain margin-left-1">
            
              <li><a href="/hub.js/guides/advanced/access-control/">Access Control</a></li>
            
              <li><a href="/hub.js/guides/advanced/entity-lifecycle/">Entity Lifecycle</a></li>
            
              <li><a href="/hub.js/guides/advanced/schema-versioning/" class="is-active">Schema Versioning</a></li>
            
              <li><a href="/hub.js/guides/advanced/permissions/">Permissions</a></li>
            
              <li><a href="/hub.js/guides/advanced/operation-stack/">OperationStack</a></li>
            
              <li><a href="/hub.js/guides/advanced/metrics/">Metrics</a></li>
            
              <li><a href="/hub.js/guides/advanced/queries-and-filters/">Queries & Filters</a></li>
            
              <li><a href="/hub.js/guides/advanced/catalog-collection/">Catalogs & Collections</a></li>
            
              <li><a href="/hub.js/guides/advanced/composing-workflows/">Composing Workflows</a></li>
            
          </ul>
        
          <li>Developers</li>
          <ul class="list-plain margin-left-1">
            
              <li><a href="/hub.js/guides/developers/e2e-tests/">E2E Testing</a></li>
            
          </ul>
        
          <li>Legacy</li>
          <ul class="list-plain margin-left-1">
            
              <li><a href="/hub.js/guides/legacy/content-search/">Search Service</a></li>
            
              <li><a href="/hub.js/guides/legacy/sites-and-pages/">Sites and Pages</a></li>
            
          </ul>
        
      </ul>
    </div>

    <div class="column-18">
      <div class="panel">
        <h1>Object Schema Versioning in Hub.js</h1>
<p>Managing the evolution of object structures (schemas) is a core challenge in long-lived applications, especially when you cannot rely on database-level migrations. In Hub.js, we address this by employing a <strong>run-time migration pattern</strong> for all objects whose structure may change over time.</p>
<h2>The Problem</h2>
<p>As the Hub.js library evolves, the shape of objects (such as entities, catalogs, or settings) may change. However, stored objects - whether in local storage, remote APIs, or other persistence layers - may still exist in older formats. We need a way to ensure that, whenever an object is loaded, it is automatically upgraded to the latest schema expected by the application.</p>
<h2>The Pattern: Run-Time Migrations</h2>
<p>The general pattern is as follows:</p>
<ul>
<li><strong>Versioning:</strong> Any object whose schema may change over time includes a <code>.schemaVersion: number</code> property. This version indicates the schema the object currently conforms to.</li>
<li><strong>Migration Functions:</strong> For each such object, we provide a migration function (e.g., <code>upgradeCatalogSchema</code>) that takes an object of any version and returns an object in the latest schema.</li>
<li><strong>Migration Chain:</strong> The migration function applies a chain of transformations, one for each version increment, so that even very old objects are brought up to date.</li>
<li><strong>Automatic Upgrades:</strong> When an entity is loaded (typically in its <code>fetch</code> process), its sub-objects are passed through the appropriate migration function. For example, an <code>IHubCatalog</code> is upgraded via <code>upgradeCatalogSchema</code> inside the entity's <code>computeProps</code> function.</li>
</ul>
<h2>Example: IHubCatalog</h2>
<p>Suppose you have an <code>IHubCatalog</code> object stored with <code>schemaVersion: 1</code>. The current application expects <code>schemaVersion: 3</code>. When a catalog is loaded as part of an Entity (e.g. a Hub Project), it is passed through <code>upgradeCatalogSchema</code>, which applies migrations for v2 and v3 in sequence, resulting in an object that matches the latest schema.</p>
<pre><code class="typescript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upgradeCatalogSchema</span>(<span class="hljs-params">catalog: <span class="hljs-built_in">any</span></span>): <span class="hljs-title">IHubCatalog</span> </span>{
  <span class="hljs-keyword">let</span> upgraded = { ...catalog };
  <span class="hljs-keyword">if</span> (!upgraded.schemaVersion || upgraded.schemaVersion &lt; <span class="hljs-number">2</span>) {
    upgraded = migrateToV2(upgraded);
    upgraded.schemaVersion = <span class="hljs-number">2</span>;
  }
  <span class="hljs-keyword">if</span> (upgraded.schemaVersion &lt; <span class="hljs-number">3</span>) {
    upgraded = migrateToV3(upgraded);
    upgraded.schemaVersion = <span class="hljs-number">3</span>;
  }
  <span class="hljs-keyword">return</span> upgraded <span class="hljs-keyword">as</span> IHubCatalog;
}
</code></pre>
<h2>Where Migrations Are Applied</h2>
<ul>
<li><strong>Entities:</strong> Most entities call their migration functions in their <code>computeProps</code> function, which is part of the <code>fetch</code> process.</li>
<li><strong>Sub-Graphs:</strong> Any sub-object (e.g., catalog, settings) that may have its own schema versioning is migrated independently.</li>
<li><strong>Special Cases:</strong> Some entities (like <code>IHubSite</code>) may have a different release schedule and handle migrations slightly differently, but the principle remains the same.</li>
</ul>
<h2>Benefits</h2>
<ul>
<li><strong>Reliability:</strong> The application can always expect to work with the latest schema, regardless of how old the stored object is.</li>
<li><strong>Flexibility:</strong> No need for database-level migrations; all upgrades happen at run-time.</li>
<li><strong>Backward Compatibility:</strong> Older objects are automatically upgraded, reducing the risk of runtime errors due to missing or outdated properties.</li>
</ul>
<h2>Summary</h2>
<p>By versioning schemas and applying run-time migrations, Hub.js ensures that all objects are always in the expected format, enabling safe evolution of your data structures over time.</p>
      </div>
    </div>
  </div>

      </main>
    </div>

    <footer class="footer">
      
      <div class="panel panel-white">
        <div class="grid-container">
          <div class="column-24">
            <a href="https://github.com/Esri/hub.js" class="font-size--2">Fork this project</a>
          </div>
        </div>
      </div>
    </footer>

    
    <script src="hub.js/js/calcite-web.min.js"></script>

    <script>
       calcite.init()
    </script>

    
  </body>
</html>